THREE.CSS3DObject=function(e){THREE.Object3D.call(this),this.element=e,this.element.style.position="absolute",this.addEventListener("removed",(function(e){if(null!==this.element.parentNode){this.element.parentNode.removeChild(this.element);for(var t=0,r=this.children.length;t<r;t++)this.children[t].dispatchEvent(e)}}))},THREE.CSS3DObject.prototype=Object.create(THREE.Object3D.prototype),THREE.CSS3DSprite=function(e){THREE.CSS3DObject.call(this,e)},THREE.CSS3DSprite.prototype=Object.create(THREE.CSS3DObject.prototype),ERNO.IeCss3DRenderer=function(e){new THREE.Matrix4;var t,r,n,a=document.createElement("div");a.style.overflow="hidden",this.domElement=a;var s=document.createElement("div");a.appendChild(s),this.setClearColor=function(){},this.setSize=function(e,o){r=e/2,n=(t=o)/2,a.style.width=e+"px",a.style.height=o+"px",s.style.width=e+"px",s.style.height=o+"px"};var o,i,l,u,c,d,p=function(e){return Math.abs(e)<1e-4?0:e},x=(o=new THREE.Vector3,i=new THREE.Vector3,l=new THREE.Euler,u=new THREE.Quaternion,l._quaternion=u,u._euler=l,function(e){return e.decompose(o,u,i),"translate3d(-50%,-50%,0) translate3d("+p(o.x)+"px, "+p(o.y)+"px, "+p(o.z)+"px) rotateX("+p(l.x)+"rad) rotateY("+p(l.y)+"rad) rotateZ("+p(l.z)+"rad) scale3d("+p(i.x)+", "+p(i.y)+", "+p(i.z)+")"}),E=new THREE.Matrix4,m=new THREE.Matrix4,D=(c=new THREE.Matrix4,new THREE.Matrix4,new THREE.Matrix4),h=new THREE.Matrix4,y=function(e,t){m.multiplyMatrices(E,e.matrixWorld),m.elements[4]*=-1,m.elements[5]*=-1,m.elements[6]*=-1,m.elements[7]*=-1,style=x(m);var r=e.element;r.style.WebkitTransform=style,r.style.MozTransform=style,r.style.oTransform=style,r.style.transform=style,r.style.WebkitPerspective=d+"px",r.style.MozPerspective=d+"px",r.style.oPerspective=d+"px",r.style.perspective=d+"px",r.parentNode!==s&&s.appendChild(r)};function f(e,t){return e.z-t.z}function v(t,r){var n=.5*e.cubeletSize;return t.userData.points[0].set(-n,-n,0).applyMatrix4(t.matrixWorld),t.userData.points[1].set(n,-n,0).applyMatrix4(t.matrixWorld),t.userData.points[2].set(n,n,0).applyMatrix4(t.matrixWorld),t.userData.points[3].set(-n,n,0).applyMatrix4(t.matrixWorld),t.userData.points.sort(f),t.userData.points}var T,R,z,H,b=(T=new THREE.Vector3,R=new THREE.Vector3,z=new THREE.Vector3,H=4,function(e,t){for(T.set(0,0,1).transformDirection(e.matrixWorld),R.set(0,0,0).applyMatrix4(e.matrixWorld),H=4;H-- >0;)if(z.subVectors(t[H],R),p(T.dot(z))<0)return!1;return!0});function w(e,t){return W(e,t,"x")&&W(e,t,"y")&&W(e,t,"z")}function M(e,t){e.copy(t[0]);for(var r=t.length;r-- >0;)e.min(t[r]);return e}function I(e,t){e.copy(t[0]);for(var r=t.length;r-- >0;)e.max(t[r]);return e}function W(e,t,r){return t.userData.max[r]>e.userData.min[r]&&e.userData.max[r]>t.userData.min[r]}var S=!0,j=[];this.render=function(s,o){var i,l,u;d=.5/Math.tan(THREE.Math.degToRad(.5*o.fov))*t,a.style.WebkitPerspective=d+"px",a.style.MozPerspective=d+"px",a.style.oPerspective=d+"px",a.style.perspective=d+"px",s.updateMatrixWorld(),void 0===o.parent&&o.updateMatrixWorld(),o.matrixWorldInverse.getInverse(o.matrixWorld),h.makeTranslation(r,-n,0),D.makeTranslation(0,0,d),E.copy(h),E.multiply(o.matrixWorldInverse),E.multiply(D),E.elements[1]*=-1,E.elements[5]*=-1,E.elements[9]*=-1,E.elements[13]*=-1,j=[],e.cubelets.forEach((function(e){e.faces.forEach((function(e){S&&void 0===e.object3D.userData.min&&(e.object3D.userData.min=new THREE.Vector3,e.object3D.userData.max=new THREE.Vector3,e.object3D.userData.points=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]),j.push(e.object3D)}))})),j.sort((function(e,t){return i=v(e),l=i[0].z,M(e.userData.min,i),I(e.userData.max,i),i=v(t),u=i[0].z,M(t.userData.min,i),I(t.userData.max,i),e.userData.zIndex=null,t.userData.zIndex=null,l-u}));e.standing.northWest.front,e.front.north.up;var c,p,x=j.length,m=j.length;for(x=0;x<m;x++){c=x;var f=j[x];for(f.userData.zIndex=null===f.userData.zIndex?x:f.userData.zIndex,c=x;c<m;c++){var T=j[c];T.userData.zIndex=null===T.userData.zIndex?c:T.userData.zIndex,w(f,T)&&(b(f,T.userData.points)?(p=f.userData.zIndex,f.userData.zIndex=Math.min(f.userData.zIndex,c),T.userData.zIndex=Math.max(p,c)):b(T,f.userData.points)&&(p=T.userData.zIndex,T.userData.zIndex=Math.min(T.userData.zIndex,f.userData.zIndex),f.userData.zIndex=Math.max(f.userData.zIndex,p)))}}var R=new THREE.Vector3(0,0,-1),z=new THREE.Vector3(0,0,-1),H=!1;objWorldPosition=new THREE.Vector3;var W=0;for(m=j.length;W<m;W++)y(j[W]),objWorldPosition.set(j[W].matrixWorld.elements[12],j[W].matrixWorld.elements[13],j[W].matrixWorld.elements[14]),R.subVectors(objWorldPosition,o.position),H=z.set(0,0,1).transformDirection(j[W].matrixWorld).dot(R)<0,j[W].element.style.visibility=H?"visible":"hidden",j[W]instanceof THREE.CSS3DObject&&(j[W].element.style.zIndex=j[W].userData.zIndex);S=!1}};