ERNO.Locked=function(e,t,n){e.domElement.ondragstart=function(){return!1};var o,a,r,i,s={enabled:!0,rotationSpeed:.8,rotateOnClick:!1},d=new ERNO.Projector(e,n),c=new THREE.Vector3,u=new THREE.Vector3,h=new THREE.Vector3,m=new THREE.Vector3,w=new THREE.Matrix4,l=new THREE.Vector3,v=window.devicePixelRatio||1;axisDefined=!1;var E=(new THREE.Matrix4).makeRotationFromEuler(new THREE.Euler(.1*Math.PI,-.25*Math.PI,0));function f(o){if(s.enabled&&null===d.getIntersection(t,(o.touches&&o.touches[0]||o).pageX,(o.touches&&o.touches[0]||o).pageY)){r=(c=n)!==document?c.getBoundingClientRect():{left:0,top:0,width:window.innerWidth,height:window.innerHeight};var i=(o.touches&&o.touches[0]||o).pageX-r.left;y=(o.touches&&o.touches[0]||o).pageY-r.top,i*=v,y*=v,null===d.getIntersection(t,i,y)&&0===e.isTweening()&&(a="undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now(),h.set(i,y,0),u.set(i,y,0),n.removeEventListener("mousedown",f),document.addEventListener("mousemove",x),document.addEventListener("mouseup",M),n.removeEventListener("touchstart",f),document.addEventListener("touchmove",x),document.addEventListener("touchend",M))}var c}function x(e){if(s.enabled){e.preventDefault();var t=(e.touches&&e.touches[0]||e).pageX-r.left;y=(e.touches&&e.touches[0]||e).pageY-r.top,t*=v,y*=v,u.set(t,y,0)}}function M(t){if(n.addEventListener("mousedown",f),document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",M),n.addEventListener("touchstart",f),document.removeEventListener("touchmove",x),document.removeEventListener("touchend",M),axisDefined){var s;o===e.slicesDictionary.x?d="x":o===e.slicesDictionary.y?d="y":o===e.slicesDictionary.z&&(d="z"),s=-Math.round(o.rotation/Math.PI*2)*Math.PI*.5,m.length()/(("undefined"!=typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now())-a)>.8&&("z"===d&&l.negate(),s=Math.round(l.dot(m.normalize()))*Math.PI*.5*i),e.twist(new ERNO.Twist(d,s.radiansToDegrees()))}else{var d,p=(t.touches&&t.touches[0]||t).pageX-r.left;y=(t.touches&&t.touches[0]||t).pageY-r.top,p*=v,y*=v;var g=b([e.front,e.right,e.up],p-r.width*v*.5,y-r.height*v*.5);c.copy(g.axis),w.getInverse(e.matrixWorld),c.transformDirection(E),c.transformDirection(w),1===Math.abs(Math.round(c.x))?d="z":1===Math.abs(Math.round(c.y))?d="y":1===Math.abs(Math.round(c.z))&&(d="x"),"y"===d&&p-r.width*v*.5<0&&(d=d.toUpperCase()),e.twist(d)}o=null,axisDefined=!1,m.set(0,0,0),u.set(0,0,0),h.set(0,0,0),a=0}var p,g,D,z,b=(p=new THREE.Vector3,g=new THREE.Matrix4,D=new THREE.Plane,z=new THREE.Vector3(0,0,0),function(t,n,o){var a,r=t.length;for(e.object3D.updateMatrixWorld(),g.getInverse(e.matrixWorld);r--;)z.set(-1*n,o,0),D.normal.copy(t[r].axis),D.normal.x=Math.abs(D.normal.x),D.normal.y=Math.abs(D.normal.y),D.normal.z=Math.abs(D.normal.z),D.constant=.5*e.size,D.normal.transformDirection(E),D.orthoPoint(z,p),(void 0===a||p.z<=a)&&(a=p.z,face=t[r]);return face});return n.addEventListener("mousedown",f),n.addEventListener("touchstart",f),s.update=function(){if(m.x=u.x-h.x,m.y=u.y-h.y,!axisDefined&&m.length()>30){if(axisDefined=!0,i=1,l.copy(m),l.normalize(),l.x=Math.round(l.x),l.y=Math.round(l.y)*(1-Math.abs(l.x)),l.x=Math.abs(l.x),l.y=Math.abs(l.y),l.z=Math.abs(l.z),c.set(-1*l.y,l.x,0),c.normalize(),c.x=Math.round(c.x),c.y=Math.round(c.y)*(1-Math.abs(c.x)),c.negate(),0===c.y){var t=b([e.front,e.right],u.x-r.width*v*.5,u.y-r.width*v*.5);c.copy(t.axis),w.getInverse(e.matrixWorld),c.transformDirection(E),c.transformDirection(w),i=-1*(Math.round(c.x)||Math.round(c.y)||Math.round(c.z))}1===Math.abs(Math.round(c.x))?o=e.slicesDictionary.z:1===Math.abs(Math.round(c.y))?o=e.slicesDictionary.y:1===Math.abs(Math.round(c.z))&&(o=e.slicesDictionary.x)}axisDefined&&(angle=-l.dot(m)/e.size,o===e.slicesDictionary.z&&(angle*=-1),angle*=i,o.rotation=angle*s.rotationSpeed)},s};