var motion,scopedCheckQueue,startTime=0,isMobile="1"==dataStore.fpdoodle,ua=navigator.userAgent,isIe=ua.indexOf("MSIE")>-1||ua.indexOf("Trident")>-1,useLockedControls=!0,controls=useLockedControls?ERNO.Locked:ERNO.Freeform;window.cube=new ERNO.Cube({hideInvisibleFaces:isMobile,controls:controls,renderer:isIe?ERNO.renderers.IeCSS3D:null}),cube.hide();var container=document.getElementById("container");if(container.appendChild(cube.domElement),isMobile&&(document.body.classList.add("mobile"),document.getElementById("bg").classList.add("graydient")),cube.addEventListener("click",(function(e){if(cube.mouseControlsEnabled){var t,o=e.detail.cubelet,n=o[e.detail.face.toLowerCase()],i=new THREE.Vector3,s=(new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0)),a=ERNO.Direction.getDirectionByName(n.normal).normal.clone();a.x=Math.abs(a.x),a.y=Math.abs(a.y),a.z=Math.abs(a.z);for(var r=cube.slices.length;r-- >0&&(t=cube.slices[r],i.copy(t.axis),i.x=Math.abs(i.x),i.y=Math.abs(i.y),i.z=Math.abs(i.z),-1===t.cubelets.indexOf(o)||!i.equals(s)););var u=t.name.substring(0,1);t===cube.down&&(u=u.invert()),cube.twist(u)}})),controls===ERNO.Locked){var fixedOrientation=new THREE.Euler(.1*Math.PI,-.25*Math.PI,0);cube.object3D.lookAt(cube.camera.position),cube.rotation.x+=fixedOrientation.x,cube.rotation.y+=fixedOrientation.y,cube.rotation.z+=fixedOrientation.z}cube.camera.position.z=2e3,cube.camera.fov=30,cube.camera.updateProjectionMatrix(),isMobile?(cube.position.y=0,cube.position.z=0):(cube.position.y=410,cube.position.z=-850),cube.mouseControlsEnabled=!1,cube.keyboardControlsEnabled=!1,cube.twistCountDown=0,cube.audioList=[],cube.audio=0,ERNO.RED.hex="#DC422F",ERNO.WHITE.hex="#FFF",ERNO.BLUE.hex="#3D81F6",ERNO.GREEN.hex="#009D54",ERNO.ORANGE.hex="#FF6C00",ERNO.YELLOW.hex="#FDCC09",ERNO.COLORLESS.hex="#000000";var Plane=function(e,t,o){THREE.Object3D.call(this),e.object3D.add(this),this.domElement=document.createElement("div"),this.domElement.classList.add(o),this.domElement.id=t,this.css3DObject=new THREE.CSS3DObject(this.domElement),this.css3DObject.name="css3DObject-"+t,this.add(this.css3DObject)};if(Plane.prototype=Object.create(THREE.Object3D.prototype),!isIe){var shadow=new Plane(cube,"shadow","shadow");function updateShadow(){requestAnimationFrame(updateShadow),shadow.rotation.z=cube.slicesDictionary.y.rotation}shadow.rotation.set(90..degreesToRadians(),(0).degreesToRadians(),(0).degreesToRadians()),shadow.position.y=-300,requestAnimationFrame(updateShadow)}function setupLogo(){cube.rotation.set(25..degreesToRadians(),(-45).degreesToRadians(),(0).degreesToRadians()),cube.typeCubeletIds=new Array(8,17,16,23,20,12,21,25),cube.typeCubelets=new ERNO.Group,cube.cubelets.forEach((function(e,t){cube.typeCubeletIds.forEach((function(t){e.id==t&&(cube.typeCubelets.add(e),e.logo=!0)}))}));var e=document.getElementsByClassName("stickerLogo");e.length>0&&e[0].classList.remove("stickerLogo"),cube.twistDuration=0;var t="zzxLFFRDuFLUrl";function o(e){for(var t=document.querySelectorAll(e),o=0;o<t.length;++o)t[o].style.backgroundColor=ERNO.WHITE.hex}cube.twistCountDown=t.length,scopedCheckQueue=checkQueue.bind(this,startScrambleAnimation),cube.addEventListener("onTwistComplete",scopedCheckQueue),cube.twist(t);var n=".cubeletId-";cube.cubelets.forEach((function(e,t){1!=e.logo&&o(n+e.id+" .sticker"),8!=e.id&&17!=e.id||o(n+e.id+" .sticker.red"),21!=e.id&&25!=e.id||o(n+e.id+" .sticker.yellow"),20==e.id&&(o(n+e.id+" .sticker.yellow"),o(n+e.id+" .sticker.orange"))})),setTimeout(scrambleCube,1e3)}function enableDeviceMotion(){motion||((motion=deviceMotion(cube,container)).decay=.1,motion.range.x=.02*Math.PI,motion.range.y=.02*Math.PI,motion.range.z=0),motion.paused=!1}function pauseDeviceMotion(){motion.paused=!0}function initiateAudio(){cube.audioList=["CubeDoodle01","CubeDoodle02","CubeDoodle03","CubeDoodle04","CubeDoodle05","CubeDoodle06","CubeDoodle07","CubeDoodle08"],cube.audio=new Html5Audio(cube.audioList,"examples/doodle-iframe/media/SingleSounds"),cube.audio.loadAll(),cube.addEventListener("onTwistComplete",(function(e){cube.audio.play(cube.audioList[Math.floor(Math.random()*(cube.audioList.length-1))])}))}function startInteractiveCube(){isMobile||enableDeviceMotion();var e=!1;startTime=(new Date).getTime(),cube.twistDuration=500,cube.moveCounter=0,cube.addEventListener("onTwistComplete",(function(t){cube.undoing&&cube.moveCounter++,moveCounter&&(moveCounter.innerText=moveCounter.textContent=cube.moveCounter),postParentMessage({moves:cube.moveCounter}),cube.isSolved()&&setTimeout((function(){cube.hideInvisibleFaces=!1,cube.showIntroverts(),shadow&&shadow.domElement&&(shadow.domElement.style.opacity="0"),e||(e=!0,doCertificate(),postParentMessage({certificate:1}))}),1e3)})),moveCounter.innerText=moveCounter.textContent=cube.moveCounter,window.parent!=window&&(uipanel.style.display="",uipanel.style.opacity="1"),isMobile||(buttonpanel.style.display="none",moveCounter.style.display="none"),postParentMessage({controls:1}),cube.mouseControlsEnabled=!0,cube.keyboardControlsEnabled=!0}function checkQueue(e){cube.twistQueue.history.length-cube.twistCountDown==0&&(cube.removeEventListener("onTwistComplete",scopedCheckQueue),e())}function postParentMessage(e){e.session=dataStore.session,window.parent&&window.parent.postMessage(e,dataStore.origin||"*")}function startScrambleAnimation(){postParentMessage({transition:1}),cube.show()}function scrambleCube(){new TWEEN.Tween(cube.position).to({x:0,y:0,z:0},3e3).easing(TWEEN.Easing.Quartic.InOut).start(cube.time),new TWEEN.Tween(cube.rotation).to({x:25..degreesToRadians(),y:45..degreesToRadians(),z:0},3e3).easing(TWEEN.Easing.Quartic.InOut).start(cube.time),cube.twistDuration=120;var e="ddurrdllrBffDUbffdurfdUbll";cube.twistCountDown=e.length+cube.twistQueue.history.length,cube.twist(e),scopedCheckQueue=checkQueue.bind(this,startInteractiveCube),cube.addEventListener("onTwistComplete",scopedCheckQueue),cube.cubelets.forEach((function(e,t){e.faces.forEach((function(e,t){var o=e.element.getElementsByClassName("sticker")[0];if(o){var n=o.style.backgroundColor;if(n){n={r:(n=n.replace(/[^\d,]/g,"").split(","))[0].toNumber(),g:n[1].toNumber(),b:n[2].toNumber()};var i=_.hexToRgb(e.color.hex);new TWEEN.Tween(n).to({r:i.r,g:i.g,b:i.b},500).onUpdate((function(){o.style.backgroundColor="rgb("+n.r.round()+","+n.g.round()+","+n.b.round()+")"})).start(cube.time)}}}))}))}function solveCube(e){for(e=e||0,cube.twistDuration=e;cube.twistQueue.history.length>0;)cube.undo()}window.setTimeout(setupLogo,100),window.addEventListener("message",(function(e){var t=e.data;if(e.origin==dataStore.origin&&t.session==dataStore.session){var o=t.update;if(o){mergeObject(o,dataStore);var n=document.querySelector("#upgradeText div.upgradetext");n&&o.msgs&&(n.textContent=n.innerText=o.msgs["Error Version 2"]||dataStore.msgs["Error Version 2"]||"")}else t.help?handleHelpClick():t.moveCounter&&solveCube()}}));var helpBubble=document.getElementById("helpbubble"),helpButton=document.getElementById("helpbutton"),helpIndex=0,helpNext=document.getElementById("helpnext"),helpText=document.getElementById("helptext"),helpImage=document.getElementById("helpimage"),moveCounter=document.getElementById("movecounter"),searchButton=document.getElementById("searchbutton"),shareBubble=document.getElementById("sharebubble"),shareButton=document.getElementById("sharebutton"),shareEmail=document.getElementById("shareemail"),shareFacebook=document.getElementById("sharefacebook"),shareGPlus=document.getElementById("sharegplus"),shareShortLink=document.getElementById("shareshortlink"),shareTwitter=document.getElementById("sharetwitter"),uipanel=document.getElementById("uipanel"),buttonpanel=document.getElementById("buttonpanel");function setMobileIcon(e){e.className=e.className.replace("_64","_96")}function addListener(e,t){isMobile?e.addEventListener("touchstart",t):e.addEventListener("click",t)}function getShortlinkForSharing(){return(dataStore.shortlink||"//google.com/doodles").replace(/.*\/\//,"http://")}function updateHelp(){helpText.textContent=helpText.innerText=dataStore.msgs["Directions "+helpIndex],helpNext.textContent=helpNext.innerText=dataStore.msgs["Directions UI "+(helpIndex<2?1:2)],1==helpIndex?(helpImage.classList.remove("two"),helpImage.classList.add("one")):2==helpIndex&&(helpImage.classList.remove("one"),helpImage.classList.add("two"))}function handleHelpClick(e){"none"==helpBubble.style.display?(helpBubble.style.display="block",helpBubble.style.pointerEvents="auto",helpIndex=1,updateHelp()):(helpBubble.style.display="none",helpBubble.style.pointerEvents="none"),shareBubble.style.opacity="0"}window.navigator.userAgent.match(/iP(hone|od|ad)/i)&&(shareEmail.style.display="none"),isMobile&&(setMobileIcon(shareGPlus),setMobileIcon(shareFacebook),setMobileIcon(shareTwitter),setMobileIcon(shareEmail),setMobileIcon(searchButton),setMobileIcon(helpButton),setMobileIcon(shareButton),shareShortLink.style.display="none"),addListener(shareGPlus,(function(e){window.open("https://plus.google.com/share?url="+encodeURIComponent(getShortlinkForSharing()))})),addListener(shareFacebook,(function(e){window.open("http://www.facebook.com/sharer.php?u="+encodeURIComponent(getShortlinkForSharing()))})),addListener(shareTwitter,(function(e){window.open("http://twitter.com/intent/tweet?status="+encodeURIComponent(dataStore.msgs["Share Message"]+" "+getShortlinkForSharing()))})),addListener(shareEmail,(function(e){window.open("mailto:?subject="+encodeURIComponent(dataStore.msgs["Share Message"])+"&body="+encodeURIComponent(getShortlinkForSharing()))})),addListener(searchButton,(function(e){postParentMessage({search:1})})),helpBubble.dir=dataStore.dir,addListener(helpBubble,(function(e){return++helpIndex>2?(helpBubble.style.display="none",helpBubble.style.pointerEvents="none"):(helpBubble.style.display="block",updateHelp()),shareBubble.style.opacity="none",e.preventDefault&&e.preventDefault(),!1})),addListener(helpButton,handleHelpClick),addListener(container,(function(e){helpBubble.style.display="none",helpBubble.style.pointerEvents="none",shareBubble.style.opacity="0"})),addListener(shareButton,(function(e){shareBubble.style.opacity="0"==shareBubble.style.opacity?"1":"0",helpBubble.style.display="none",shareShortLink.value=dataStore.shortlink.replace(/^\/\//,"")})),shareShortLink.addEventListener("mouseup",(function(e){e.preventDefault(),shareShortLink.select()}));